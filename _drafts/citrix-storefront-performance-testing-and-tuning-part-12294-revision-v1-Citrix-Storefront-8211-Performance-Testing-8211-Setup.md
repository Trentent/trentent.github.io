---
id: 2299
title: 'Citrix Storefront &#8211; Performance Testing &#8211; Setup'
date: 2017-05-23T22:48:25-06:00
author: trententtye
layout: revision
guid: http://theorypc.ca/2017/05/23/2294-revision-v1/
permalink: /2017/05/23/2294-revision-v1/
---
I&#8217;ve used the [Web Capacity Analysis Tool (WCAT)](https://www.iis.net/downloads/community/2007/05/wcat-63-x86) in the past to measure the [performance of Citrix Web Interface](https://theorypc.ca/2014/11/23/slow-citrix-web-interface-5-4-on-aspx-pages-or-how-to-load-test-your-wi/) with some success. Â So I thought this tool would be perfect for load testing Storefront. Â I loaded up Fiddler, [set up the WCAT extension](http://fiddler2wcat.codeplex.com/releases/view/35356), captured a web logon and then application launch. Â The whole process looked like this:

<div style="width: 1042px;" class="wp-video">
  <video class="wp-video-shortcode" id="video-2299-81" width="1042" height="766" preload="metadata" controls="controls"><source type="video/mp4" src="http://theorypc.ca/wp-content/uploads/2017/05/Storefront.mp4?_=81" /><a href="http://theorypc.ca/wp-content/uploads/2017/05/Storefront.mp4">http://theorypc.ca/wp-content/uploads/2017/05/Storefront.mp4</a></video>
</div>

Pretty simple right?

I logged on with Domain Passthrough authentication, I clicked on an application and I was done. Â I have [my customizations added in](https://theorypc.ca/2017/05/11/citrix-storefront-adventures-in-customization-dynamically-configure-features-based-on-group-membership/) as well. Â But what isÂ _actually_ happening? Â How long does each step of the actual process take? Â To determine this answer, [we go to Fiddler](http://www.telerik.com/fiddler)Â to capture our flow so we can examine each step.

<img class="aligncenter size-full wp-image-2296" src="http://theorypc.ca/wp-content/uploads/2017/05/fiddler-1.png" alt="" width="1545" height="880" srcset="http://theorypc.ca/wp-content/uploads/2017/05/fiddler-1.png 1545w, http://theorypc.ca/wp-content/uploads/2017/05/fiddler-1-300x171.png 300w, http://theorypc.ca/wp-content/uploads/2017/05/fiddler-1-768x437.png 768w" sizes="(max-width: 1545px) 100vw, 1545px" /> 

I truncated all the icon resource calling. Â You can see it calls around 120 individual icon URLs. Â I have my two custom &#8216;helpers&#8217; that determine logon preference and whether we should get workspace control enabled or disabled (LogonType.aspx and GroupMembership.aspx).

So the actual calls to Storefront revolve around 7 unique queries to the Storefront server. Â They are:

<pre class="lang:default decode:true ">/Home/Configuration
/Resources/List
/Authentication/GetUserName
/ExplicitAuth/AllowSelfServiceAccountManagement
/Authentication/GetUserName
/Resources/GetLaunchStatus/&lt;string&gt;
/Resources/LaunchIca/&lt;string&gt;</pre>

Fortunately, Citrix [has documented how these need to be configured to successfully call these services](https://citrix.github.io/storefront-sdk/requests/).

With all this setup, I took my scenario file and executed it. Â Nothing appeared to happen. Â I broke down the scenario file into the individual calls and found where it was breaking. Â [This Citrix documentation explains it nicely](https://citrix.github.io/storefront-sdk/how-the-api-works/):

<h2 id="cross-site-request-forgery-token" style="padding-left: 30px;">
  Cross-site request forgery token
</h2>

<p style="padding-left: 30px;">
  To protect against cross-site request forgery (CSRF) attacks, the Web Proxy APIs require that a CSRF token be supplied by the client, unless specified otherwise. This is a random string generated by the Web Proxy for the duration of the session and communicated to the client using a session cookie. <span style="text-decoration: underline;"><strong>Clients must read the value of this cookie and send it back to the Web Proxy</strong></span> in most API calls, as either the value of a header named Csrf-Token (note the hyphen) for POST requests, or as the value of a query string parameter named CsrfToken for GET requests.
</p>

&nbsp;

The part in bold and underlined, is troublesome with WCAT. Â WCAT does not appear to have this ability (read the value of a cookie and set a header to send it back to the web proxy).

&nbsp;

&nbsp;

&nbsp;

&nbsp;

<!-- AddThis Advanced Settings generic via filter on the_content -->

<!-- AddThis Share Buttons generic via filter on the_content -->